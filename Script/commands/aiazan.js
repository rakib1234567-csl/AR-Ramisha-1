const axios = require("axios");
const schedule = require("node-schedule");

module.exports.config = {
  name: "aiazan",
  version: "1.1.0",
  role: 0,
  credits: "Rakib Boss",
  description: "Sylhet timezone auto ajan message sender",
  hasPrefix: false,
  usages: "auto ajan",
  cooldowns: 5,
};

module.exports.run = async function ({ api }) {
  const waqtMessages = {
    fajr: `‚ï≠‚Ä¢‚îÑ‚îÖ‚ïê‚ïê‚ùÅüå∫‚ùÅ‚ïê‚ïê‚îÖ‚îÑ‚Ä¢‚ïÆ
‚Ä¢¬ª‚ú®"‡¶´‡¶ú‡¶∞"-‡¶è‡¶∞ ‡¶Ü‡¶ú‡¶æ‡¶®‚ú®¬´‚Ä¢
‚ï∞‚Ä¢‚îÑ‚îÖ‚ïê‚ïê‚ùÅüå∫‚ùÅ‚ïê‚ïê‚îÖ‚îÑ‚Ä¢‚ïØ

‡¶Ü‡¶∏‡¶∏‡¶æ‡¶≤‡¶æ‡¶Æ‡ßÅ ‡¶Ü‡¶≤‡¶æ‡¶á‡¶ï‡ßÅ‡¶Æ!
‡¶≠‡ßã‡¶∞‡ßá‡¶∞ ‡¶Ü‡¶≤‡ßã ‡¶â‡¶†‡ßá‡¶õ‡ßá, ‡¶è‡¶¨‡¶æ‡¶∞ "‡¶´‡¶ú‡¶∞" ‡¶è‡¶∞ ‡¶®‡¶æ‡¶Æ‡¶æ‡¶ú‡ßá ‡¶ö‡¶≤‡ßÅ‡¶® ‡¶≠‡¶æ‡¶á ‡¶ì ‡¶¨‡¶á‡¶® ‡¶Ö‡¶ï‡¶≤‡•§

‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß‡ßá -
AR Bot & RAKIB BOSS`,

    dhuhr: `‚ï≠‚Ä¢‚îÑ‚îÖ‚ïê‚ïê‚ùÅüå∫‚ùÅ‚ïê‚ïê‚îÖ‚îÑ‚Ä¢‚ïÆ
‚Ä¢¬ª‚ú®"‡¶Ø‡ßã‡¶π‡¶∞"-‡¶è‡¶∞ ‡¶Ü‡¶ú‡¶æ‡¶®‚ú®¬´‚Ä¢
‚ï∞‚Ä¢‚îÑ‚îÖ‚ïê‚ïê‚ùÅüå∫‚ùÅ‚ïê‚ïê‚îÖ‚îÑ‚Ä¢‚ïØ

‡¶Ü‡¶∏‡¶∏‡¶æ‡¶≤‡¶æ‡¶Æ‡ßÅ ‡¶Ü‡¶≤‡¶æ‡¶á‡¶ï‡ßÅ‡¶Æ!
‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶Æ‡¶æ‡¶ù‡¶ñ‡¶æ‡¶®‡ßá ‡¶∂‡¶æ‡¶®‡ßç‡¶§‡¶ø‡¶∞ ‡¶®‡¶æ‡¶Æ‡¶æ‡¶ú - "‡¶Ø‡ßã‡¶π‡¶∞" ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡¶á‡¶õ‡ßá, ‡¶∏‡¶¨‡¶æ‡¶á ‡¶®‡¶æ‡¶Æ‡¶æ‡¶ú‡ßá ‡¶ö‡¶≤‡ßÅ‡¶®‡•§

‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß‡ßá -
AR BOT & RAKIB BOSS`,

    asr: `‚ï≠‚Ä¢‚îÑ‚îÖ‚ïê‚ïê‚ùÅüå∫‚ùÅ‚ïê‚ïê‚îÖ‚îÑ‚Ä¢‚ïÆ
‚Ä¢¬ª‚ú®"‡¶Ü‡¶∏‡¶∞"-‡¶è‡¶∞ ‡¶Ü‡¶ú‡¶æ‡¶®‚ú®¬´‚Ä¢
‚ï∞‚Ä¢‚îÑ‚îÖ‚ïê‚ïê‚ùÅüå∫‚ùÅ‚ïê‚ïê‚îÖ‚îÑ‚Ä¢‚ïØ

‡¶Ü‡¶∏‡¶∏‡¶æ‡¶≤‡¶æ‡¶Æ‡ßÅ ‡¶Ü‡¶≤‡¶æ‡¶á‡¶ï‡ßÅ‡¶Æ!
‡¶¨‡¶ø‡¶ï‡ßá‡¶≤‡ßá‡¶∞ ‡¶Ü‡¶≤‡ßã‡¶§‡ßá ‡¶Ü‡¶∏‡¶∞‡ßá‡¶∞ ‡¶Ü‡¶ú‡¶æ‡¶® ‡¶π‡¶á‡¶õ‡ßá, ‡¶∏‡¶¨‡¶æ‡¶á ‡¶®‡¶æ‡¶Æ‡¶æ‡¶ú‡ßá ‡¶Ø‡¶æ‡¶¨‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§‡¶ø ‡¶®‡¶ø‡¶®‡•§

‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß‡ßá -
AR BOT & RAKIB BOSS`,

    maghrib: `‚ï≠‚Ä¢‚îÑ‚îÖ‚ïê‚ïê‚ùÅüå∫‚ùÅ‚ïê‚ïê‚îÖ‚îÑ‚Ä¢‚ïÆ
‚Ä¢¬ª‚ú®"‡¶Æ‡¶æ‡¶ó‡¶∞‡¶ø‡¶¨"-‡¶è‡¶∞ ‡¶Ü‡¶ú‡¶æ‡¶®‚ú®¬´‚Ä¢
‚ï∞‚Ä¢‚îÑ‚îÖ‚ïê‚ïê‚ùÅüå∫‚ùÅ‚ïê‚ïê‚îÖ‚îÑ‚Ä¢‚ïØ

‡¶Ü‡¶∏‡¶∏‡¶æ‡¶≤‡¶æ‡¶Æ‡ßÅ ‡¶Ü‡¶≤‡¶æ‡¶á‡¶ï‡ßÅ‡¶Æ!üñ§
‡¶∏‡ßÇ‡¶∞‡ßç‡¶Ø ‡¶Ö‡¶∏‡ßç‡¶§ ‡¶Ø‡¶æ‡¶ö‡ßç‡¶õ‡ßá, "‡¶Æ‡¶æ‡¶ó‡¶∞‡¶ø‡¶¨" ‡¶è‡¶∞ ‡¶∏‡¶Æ‡ßü ‡¶π‡ßü‡ßá ‡¶ó‡ßá‡¶õ‡ßá ‚Äî ‡¶∏‡¶¨‡¶æ‡¶á ‡¶®‡¶æ‡¶Æ‡¶æ‡¶ú‡ßá ‡¶ö‡¶≤‡ßÅ‡¶®‡•§

‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß‡ßá -
AR BOT & RAKIB BOSS`,

    isha: `‚ï≠‚Ä¢‚îÑ‚îÖ‚ïê‚ïê‚ùÅüå∫‚ùÅ‚ïê‚ïê‚îÖ‚îÑ‚Ä¢‚ïÆ
‚Ä¢¬ª‚ú®"‡¶è‡¶∂‡¶æ"-‡¶è‡¶∞ ‡¶Ü‡¶ú‡¶æ‡¶®‚ú®¬´‚Ä¢
‚ï∞‚Ä¢‚îÑ‚îÖ‚ïê‚ïê‚ùÅüå∫‚ùÅ‚ïê‚ïê‚îÖ‚îÑ‚Ä¢‚ïØ

‡¶Ü‡¶∏‡¶∏‡¶æ‡¶≤‡¶æ‡¶Æ‡ßÅ ‡¶Ü‡¶≤‡¶æ‡¶á‡¶ï‡ßÅ‡¶Æ!
‡¶∞‡¶æ‡¶§‡ßá‡¶∞ ‡¶®‡ßÄ‡¶∞‡¶¨‡¶§‡¶æ‡ßü ‡¶Ü‡¶≤‡ßç‡¶≤‡¶æ‡¶π‡¶∞ ‡¶°‡¶æ‡¶ï‡ßá ‡¶∏‡¶æ‡ßú‡¶æ ‡¶¶‡¶ø‡¶®, ‡¶è‡¶∂‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ‡¶æ‡¶ú ‡¶™‡ßú‡¶ø ‡¶∏‡¶¨‡¶æ‡¶á‡•§

‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß‡ßá -
AR BOT & RAKIB BOSS`,
  };

  async function getPrayerTimes() {
    const res = await axios.get(
      "https://api.aladhan.com/v1/timingsByCity?city=Sylhet&country=Bangladesh&method=2"
    );
    return res.data.data.timings;
  }

  async function scheduleAjan() {
    const timings = await getPrayerTimes();

    const waqtList = {
      fajr: timings.Fajr,
      dhuhr: timings.Dhuhr,
      asr: timings.Asr,
      maghrib: timings.Maghrib,
      isha: timings.Isha,
    };

    const allThreads = global.data.allThreadID || [];

    for (const waqt in waqtList) {
      const [hour, min] = waqtList[waqt].split(":").map(Number);

      schedule.scheduleJob({ hour, minute: min, tz: "Asia/Dhaka" }, () => {
        const msg = waqtMessages[waqt];
        for (const tid of allThreads) {
          api.sendMessage(msg, tid, (err) => {
            if (err) console.error(`‚ùå ${waqt} ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶™‡¶æ‡¶†‡¶æ‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ [${tid}]:`, err);
          });
        }
        console.log(`‚úÖ ${waqt} ‡¶Ü‡¶ú‡¶æ‡¶®‡ßá‡¶∞ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡ßü‡ßá‡¶õ‡ßá`);
      });
    }
  }

  await scheduleAjan();
  return api.sendMessage("‚úÖ ‡¶Ü‡¶ú‡¶æ‡¶® ‡¶ü‡¶æ‡¶á‡¶Æ ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ ‡¶Ö‡¶ü‡ßã ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!", global.GoatBot.autoAjanNotify || event.threadID);
};
