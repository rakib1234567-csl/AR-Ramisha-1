const fs = require("fs-extra");

module.exports.config = {
  name: "approve",
  version: "1.0.0",
  hasPermssion: 2, // рж╢рзБржзрзБржорж╛рждрзНрж░ ржмржЯ ржЕрзНржпрж╛ржбржорж┐ржи ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗ
  credits: "RAKIB BOSS",
  description: "ржЧрзНрж░рзБржк ржЕрзНржпрж╛ржкрзНрж░рзБржн ржХрж░рзЗ ржмржЯ ржЪрж╛рж▓рзБ ржХрж░рж╛ рж╣рзЯ",
  commandCategory: "system",
  usages: "[approve]",
  cooldowns: 5,
};

module.exports.handleEvent = async function ({ api, event }) {
  const { threadID, body } = event;
  const approvedPath = __dirname + "/cache/approvedGroups.json";

  // ржпржжрж┐ ржлрж╛ржЗрж▓ ржирж╛ ржерж╛ржХрзЗ рждрж╛рж╣рж▓рзЗ рждрзИрж░рж┐ ржХрж░рзЛ
  if (!fs.existsSync(approvedPath)) {
    fs.writeFileSync(approvedPath, JSON.stringify([]));
  }

  const approvedGroups = JSON.parse(fs.readFileSync(approvedPath));

  // ржпржжрж┐ ржЧрзНрж░рзБржк ржЕржирзБржорзЛржжрж┐ржд ржирж╛ рж╣рзЯ, ржХрзЛржирзЛ ржХржорж╛ржирзНржб ржХрж╛ржЬ ржХрж░ржмрзЗ ржирж╛
  if (!approvedGroups.includes(threadID)) {
    if (body && body.startsWith(global.config.PREFIX)) {
      return api.sendMessage("ЁЯУ┐", threadID);
    }
  }
};

module.exports.run = async function ({ api, event, args }) {
  const approvedPath = __dirname + "/cache/approvedGroups.json";
  const { threadID } = event;

  // ржпржжрж┐ ржлрж╛ржЗрж▓ ржирж╛ ржерж╛ржХрзЗ, рждрзИрж░рж┐ ржХрж░рзЛ
  if (!fs.existsSync(approvedPath)) {
    fs.writeFileSync(approvedPath, JSON.stringify([]));
  }

  const approvedGroups = JSON.parse(fs.readFileSync(approvedPath));

  // ржпржжрж┐ ржЖржЧрзЗржЗ ржЕржирзБржорзЛржжржи ржерж╛ржХрзЗ
  if (approvedGroups.includes(threadID)) {
    return api.sendMessage("тЬЕ ржПржЗ ржЧрзНрж░рзБржк ржЗрждрзЛржоржзрзНржпрзЗ ржЕржирзБржорзЛржжрж┐рждред", threadID);
  }

  // ржЕрзНржпрж╛ржкрзНрж░рзБржн ржХрж░рзЗ рж▓рж┐рж╕рзНржЯрзЗ ржпрзЛржЧ ржХрж░рзЛ
  approvedGroups.push(threadID);
  fs.writeFileSync(approvedPath, JSON.stringify(approvedGroups, null, 2));

  const message = `тХнтФАтФАтФАтФАтЭЦЁЯМЯтЭЦтФАтФАтФАтФАтХо
┬а┬а┬атЬЕ ржЕржирзБржорзЛржжржи ржмрж╛рж░рзНрждрж╛ тЬЕ
тХ░тФАтФАтФАтФАтЭЦЁЯМЯтЭЦтФАтФАтФАтФАтХп

тЬи ржЕржнрж┐ржиржирзНржжржи! ржЖржкржирж╛рж░ ржЧрзНрж░рзБржкржЯрж┐ рж╕ржлрж▓ржнрж╛ржмрзЗ ржЕржирзБржорзЛржжрж┐ржд рж╣ржпрж╝рзЗржЫрзЗред

тЬк ржЖржорж┐ ржПрж╕рзЗ ржЧрзЗржЫрж┐ ржЖржкржирж╛ржжрзЗрж░ ржорж╛ржЭрзЗ рж░рж╛ржХрж┐ржм ржмрж╕ ржПрж░ЁЯСЗ 

 тХнтАвтФДтФЕтХРтХРтЭБЁЯМ╗тЭБтХРтХРтФЕтФДтАвтХо
ЁЯМ║ тЬк ${global.config.BOTNAME} тЬк ЁЯМ║
 тХ░тАвтФДтФЕтХРтХРтЭБЁЯМ╗тЭБтХРтХРтФЕтФДтАвтХп

тХнтФАтФАтЪая╕П рж╕рждрж░рзНржХ ржмрж╛рж░рзНрждрж╛ тЪая╕ПтФАтФАтХо
ЁЯУМ ржПржЗ ржмржЯржЯрж┐ рж╢рзБржзрзБржорж╛рждрзНрж░
ржЬрзНржЮрж╛ржиржорзВрж▓ржХ ржУ ржмрж┐ржирзЛржжржиржорзВрж▓ржХ
ржЙржжрзНржжрзЗрж╢рзНржпрзЗ ржмрзНржпржмрж╣рж╛рж░рзЗрж░ ржЬржирзНржпред
ЁЯЪл ржХрзЛржирзЛ рж░ржХржо ржЕрж╢рзНрж▓рзАрж▓рждрж╛,
ржЧрж╛рж▓рж╛ржЧрж╛рж▓рж┐, ржЕржкржорж╛ржиржЬржиржХ
рж╢ржмрзНржж ржмрзНржпржмрж╣рж╛рж░ ржмрж╛ ржХрж╛рж░рзЛрж░
ржЕржирзБржнрзВрждрж┐рждрзЗ ржЖржШрж╛ржд ржХрж░рж╛рж░
ржЪрзЗрж╖рзНржЯрж╛ ржПржХрзЗржмрж╛рж░рзЗржЗ 
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а**ржирж┐рж╖рж┐ржжрзНржз**ред

┬а┬а┬а┬атА╝я╕П ржЕржирзБржЧрзНрж░рж╣ ржХрж░рзЗ ржПрж╕ржм
┬а┬а┬а┬а┬а┬а┬а┬аржерзЗржХрзЗ ржмрж┐рж░ржд ржерж╛ржХрзБржиред
тХ░тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтХп

ЁЯТЦ ржЖрж╕рзБржи ржЖржорж░рж╛ рж╕ржмрж╛ржЗ ржорж┐рж▓рзЗ ржЧржбрж╝рзЗ рждрзБрж▓рж┐тАФ
ржПржХржЯрж┐ рж╕рзБржирзНржжрж░, ржирж┐рж░рж╛ржкржж ржУ рж╕ржорзНржорж╛ржиржЬржиржХ ржЕржирж▓рж╛ржЗржи ржкрж░рж┐ржмрзЗрж╢ред

      ЁЯФе ЁЭРБЁЭРиЁЭРн ЁЭРАЁЭРЭЁЭРжЁЭРвЁЭРз ЁЯФе┬а┬а
ЁЯМ╣тШЮя╕Оя╕Оя╕О ЁЭРСЁЭРАЁЭРКЁЭРИЁЭРБ ЁЭРБЁЭРОЁЭРТЁЭРТ тШЬя╕Оя╕Оя╕О тЬ░

ЁЯЩИ ЁЭРОЁЭР░ЁЭРзЁЭРЮЁЭРл ЁЭРЕЁЭРЪЁЭРЬЁЭРЮЁЭРЫЁЭРиЁЭРиЁЭРд ЁЯЩИ┬а┬а
тЮк facebook.com/profile.php?id=100044487340424 ЁЯХКя╕П

ЁЯУЮ ЁЭРЦЁЭРбЁЭРЪЁЭРнЁЭРмЁЭРАЁЭРйЁЭРй: +8801601-150660┬а┬а
тЬЙя╕П ЁЭРДЁЭРжЁЭРЪЁЭРвЁЭРе: rakib.ali.csl@gmail.com┬а┬а
ЁЯУ▒ ЁЭРМЁЭРиЁЭРЫЁЭРвЁЭРеЁЭРЮ: +8801601-150660

   тЬзтХРтХРтХРтАвтЭБтЭАтЭБтАвтХРтХРтХРтЬз

┬а  ┬аЁЯМ╕ ЁЭРБЁЭРиЁЭРн ЁЭРПЁЭРлЁЭРЮЁЭРЯЁЭРвЁЭР▒ ЁЯМ╕┬а┬а
 ┬а тЬ░┬а┬атШЮя╕Оя╕Оя╕О " - " тШЬя╕Оя╕Оя╕О тЬ░

┬а┬а┬атЩея╕ПтАвтАвЁЭРБЁЭРиЁЭРн ЁЭРОЁЭР░ЁЭРзЁЭРЮЁЭРл тАвтАвтЩея╕П

тФПтФБЁЯХКя╕П-тЭА-┬░:ЁЯОА:┬░-тЭА-ЁЯТЮтФБтФУ┬а┬а
 ЁЯМ╕тЬжЁЭРСЁЭРАЁЭРКЁЭРИЁЭРБ ЁЭРБЁЭРОЁЭРТЁЭРТ тЬжЁЯМ╕┬а┬а
тФЧтФБЁЯХКя╕П-тЭА-┬░:ЁЯОА:┬░-тЭА-ЁЯТЮтФБтФЫ`;

  const attachmentPath = __dirname + "/cache/approve.png";
  if (fs.existsSync(attachmentPath)) {
    return api.sendMessage({
      body: message,
      attachment: fs.createReadStream(attachmentPath)
    }, threadID);
  } else {
    return api.sendMessage(message, threadID);
  }
};
